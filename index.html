<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The I Ching Oracle | Oracle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0f1115;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text-main: #e0e0e0;
            --text-muted: #888;
            --gold: #d4af37;
            --gold-glow: rgba(212, 175, 55, 0.4);
            --moving-color: #ff4757; /* Vibrant Red for moving lines */
            --moving-glow: rgba(255, 71, 87, 0.6);
            --coin-silver: #bdc3c7;
            --coin-gold: #f1c40f;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1a1d26 0%, var(--bg-color) 80%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* --- Header & Toggle --- */
        header {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        #lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
            font-weight: bold;
            font-size: 0.8rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #lang-toggle:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        /* --- Typography --- */
        h1, h2, h3 {
            font-family: 'Cinzel', serif;
            font-weight: 400;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #fff, var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            letter-spacing: 2px;
            margin-top: 10px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-align: center;
        }

        /* --- Layout --- */
        main {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* --- The Stage (Coin Animation) --- */
        #stage {
            width: 100%;
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 2rem;
            perspective: 1000px;
        }

        .coin {
            width: 60px;
            height: 60px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s ease-out;
        }

        .coin-side {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.1);
        }

        .coin-head {
            background: radial-gradient(circle at 30% 30%, var(--coin-gold), #b7950b);
            color: #5d4d06;
            transform: rotateY(0deg);
        }

        .coin-tail {
            background: radial-gradient(circle at 30% 30%, var(--coin-silver), #7f8c8d);
            color: #2c3e50;
            transform: rotateY(180deg);
        }

        .coin.active {
            animation: toss 1s ease-in-out;
        }

        @keyframes toss {
            0% { transform: rotateY(0) translateY(0); }
            50% { transform: rotateY(720deg) translateY(-100px); }
            100% { transform: rotateY(var(--final-rotation)) translateY(0); }
        }

        /* --- Hexagram Display --- */
        #hexagram-container {
            width: 300px;
            height: 200px;
            display: flex;
            flex-direction: column-reverse; /* Lines build from bottom */
            justify-content: center;
            gap: 8px;
            margin-bottom: 2rem;
            opacity: 0;
            transition: opacity 0.5s;
        }

        #hexagram-container.visible {
            opacity: 1;
        }

        .line {
            height: 16px;
            width: 100%;
            background: var(--text-main);
            position: relative;
            box-shadow: 0 0 5px var(--gold-glow);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInLine 0.5s forwards;
        }

        @keyframes fadeInLine {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Yang (Solid) */
        .line.yang {
            background: var(--text-main);
        }

        /* Moving Yang (Solid Red) */
        .line.yang.moving {
            background: var(--moving-color);
            box-shadow: 0 0 10px var(--moving-glow);
        }

        /* Yin (Broken) */
        .line.yin {
            background: transparent;
            display: flex;
            justify-content: space-between;
        }
        .line.yin::before, .line.yin::after {
            content: '';
            display: block;
            width: 44%;
            height: 100%;
            background: var(--text-main);
            box-shadow: 0 0 5px var(--gold-glow);
        }

        /* Moving Yin (Broken Red) */
        .line.yin.moving::before,
        .line.yin.moving::after {
            background: var(--moving-color);
            box-shadow: 0 0 8px var(--moving-glow);
        }

        /* --- Controls --- */
        #cast-btn {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 15px 40px;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        #cast-btn:hover {
            background: var(--gold);
            color: var(--bg-color);
            box-shadow: 0 0 20px var(--gold-glow);
        }

        #cast-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: var(--text-muted);
            color: var(--text-muted);
        }

        /* --- Result Card --- */
        #result-card {
            width: 100%;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            display: none;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hex-name {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 5px;
        }

        .hex-pinyin {
            font-style: italic;
            color: var(--text-muted);
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .hex-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #ccc;
        }

        .moving-lines-msg {
            color: var(--moving-color);
            font-size: 0.9rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: none;
            font-weight: bold;
        }

        .keywords {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .tag {
            background: rgba(212, 175, 55, 0.1);
            color: var(--gold);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* --- Toast Notification --- */
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
        }
        #toast.show {
            opacity: 1;
        }

    </style>
</head>
<body>

    <header>
        <button id="lang-toggle" title="Switch Language">FR</button>
        <h1 id="app-title">THE I CHING ORACLE</h1>
        <div class="subtitle" id="app-subtitle">Book of Changes</div>
    </header>

    <main>
        <!-- Animation Stage -->
        <section id="stage">
            <div class="coin" id="coin1">
                <div class="coin-side coin-head">Y</div>
                <div class="coin-side coin-tail">—</div>
            </div>
            <div class="coin" id="coin2">
                <div class="coin-side coin-head">Y</div>
                <div class="coin-side coin-tail">—</div>
            </div>
            <div class="coin" id="coin3">
                <div class="coin-side coin-head">Y</div>
                <div class="coin-side coin-tail">—</div>
            </div>
        </section>

        <!-- Hexagram Construction Area -->
        <section id="hexagram-container">
            <!-- Lines will be injected here -->
        </section>

        <!-- Controls -->
        <button id="cast-btn">Cast the Coins</button>

        <!-- Result Display -->
        <article id="result-card">
            <h2 class="hex-name" id="res-name"></h2>
            <p class="hex-pinyin" id="res-pinyin"></p>
            <div class="keywords" id="res-keywords"></div>
            <p class="hex-description" id="res-desc"></p>
            <div class="moving-lines-msg" id="moving-msg">
                Moving lines detected. Change is imminent.
            </div>
        </article>
    </main>

    <div id="toast"></div>

    <script>
        /**
         * LANGUAGE CONFIGURATION
         */
        const uiText = {
            en: {
                title: "THE YIKING",
                subtitle: "Book of Changes",
                cast: "Cast the Coins",
                consulting: "Consulting...",
                castAgain: "Cast Again",
                movingMsg: "Moving lines detected. Change is imminent."
            },
            fr: {
                title: "LE YIKING",
                subtitle: "Livre des Mutations",
                cast: "Tirer les Pièces",
                consulting: "Consultation...",
                castAgain: "Rejouer",
                movingMsg: "Lignes mutantes détectées. Le changement est imminent."
            }
        };

        let currentLang = 'en';

        /**
         * HEXAGRAM DATA (Bilingual)
         * Keys are binary strings: 1 = Yang, 0 = Yin (Top to Bottom).
         */
        const hexagramData = {
            "111111": { 
                pinyin: "Qián", 
                en: { name: "The Creative", keywords: ["Force", "Creativity", "Persistence"], desc: "The work begins. Supreme success. Furthering through perseverance." }, 
                fr: { name: "Le Créateur", keywords: ["Force", "Créativité", "Persévérance"], desc: "L'œuvre commence. Succès suprême. La persévérance favorise l'avancement." } 
            },
            "000000": { 
                pinyin: "Kūn", 
                en: { name: "The Receptive", keywords: ["Yielding", "Devotion", "Support"], desc: "Supreme success. The mare has calmness. If you undertake something, confusion leads to misfortune." }, 
                fr: { name: "Le Récepteur", keywords: ["Docilité", "Dévouement", "Soutien"], desc: "Succès suprême. La jument a de la patience. Si vous entreprenez quelque chose, la confusion mène au malheur." } 
            },
            "100010": { 
                pinyin: "Zhūn", 
                en: { name: "Difficulty at Beginning", keywords: ["New Start", "Obstacles", "Hope"], desc: "Supreme success. Furthering through perseverance. Do not seek to undertake anything." }, 
                fr: { name: "La Difficulté au Début", keywords: ["Nouveau Départ", "Obstacles", "Espérance"], desc: "Succès suprême. Persévérance. Ne cherchez pas à entreprendre quoi que ce soit maintenant." } 
            },
            "010001": { 
                pinyin: "Méng", 
                en: { name: "Youthful Folly", keywords: ["Ignorance", "Learning", "Growth"], desc: "Success. I do not seek the youthful fool; The youthful fool seeks me." }, 
                fr: { name: "La Folie de la Jeunesse", keywords: ["Ignorance", "Apprentissage", "Croissance"], desc: "Succès. Ce n'est pas moi qui cherche le jeune ignorant ; c'est le jeune ignorant qui me cherche." } 
            },
            "111010": { 
                pinyin: "Xū", 
                en: { name: "Waiting", keywords: ["Patience", "Nourishment", "Timing"], desc: "You are correct in waiting. If you are sincere, you have light and success." }, 
                fr: { name: "L'Attente", keywords: ["Patience", "Nourriture", "Temps"], desc: "Il est juste d'attendre. Si vous êtes sincère, vous aurez lumière et succès." } 
            },
            "010111": { 
                pinyin: "Sòng", 
                en: { name: "Conflict", keywords: ["Struggle", "Lawsuit", "Retreat"], desc: "You are sincere and are being obstructed. A cautious halt brings good fortune." }, 
                fr: { name: "Le Conflit", keywords: ["Lutte", "Procès", "Recul"], desc: "Vous êtes sincère mais vous êtes empêché. Une halte prudente apporte le bonheur." } 
            },
            "010000": { 
                pinyin: "Shī", 
                en: { name: "The Army", keywords: ["Discipline", "Collective", "Action"], desc: "The army needs perseverance and a strong man. Good fortune without blame." }, 
                fr: { name: "L'Armée", keywords: ["Discipline", "Collectif", "Action"], desc: "L'armée a besoin de persévérance et d'un homme fort. Bonheur sans faute." } 
            },
            "000010": { 
                pinyin: "Bǐ", 
                en: { name: "Holding Together", keywords: ["Unity", "Alliance", "Cooperation"], desc: "Hold together with good fortune." }, 
                fr: { name: "L'Union", keywords: ["Unité", "Alliance", "Coopération"], desc: "Tenir ensemble apporte le bonheur." } 
            },
            "111011": { 
                pinyin: "Xiǎo Chǔ", 
                en: { name: "Small Taming", keywords: ["Modesty", "Restraint", "Preparation"], desc: "Dense clouds, no rain yet. The west wind brings rain." }, 
                fr: { name: "Le Petit Retenue", keywords: ["Modestie", "Restriction", "Préparation"], desc: "Nuages denses, pas encore de pluie. Le vent d'ouest apporte la pluie." } 
            },
            "110111": { 
                pinyin: "Lǚ", 
                en: { name: "Treading", keywords: ["Conduct", "Carefulness", "Progress"], desc: "Treading upon the tail of the tiger. It does not bite the man. Success." }, 
                fr: { name: "La Marche", keywords: ["Conduite", "Prudence", "Progrès"], desc: "Marcher sur la queue du tigre. Il ne mord pas l'homme. Succès." } 
            },
            "111000": { 
                pinyin: "Tài", 
                en: { name: "Peace", keywords: ["Prosperity", "Harmony", "Expansion"], desc: "The small departs, the great approaches. Good fortune. Success." }, 
                fr: { name: "La Paix", keywords: ["Prospérité", "Harmonie", "Expansion"], desc: "Le petit s'en va, le grand approche. Bonheur. Succès." } 
            },
            "000111": { 
                pinyin: "Pǐ", 
                en: { name: "Standstill", keywords: ["Stagnation", "Withdrawal", "Patience"], desc: "The great departs, the small approaches. Persistence brings misfortune." }, 
                fr: { name: "L'Arrêt", keywords: ["Stagnation", "Retrait", "Patience"], desc: "Le grand s'en va, le petit approche. La persistance amène le malheur." } 
            },
            "101111": { 
                pinyin: "Tóng Rén", 
                en: { name: "Fellowship", keywords: ["Community", "Relationships", "Sharing"], desc: "Fellowship with men in the open. Success. Perseverance furthers." }, 
                fr: { name: "La Communauté", keywords: ["Communauté", "Relations", "Partage"], desc: "Communauté avec les hommes en plein air. Succès. La persévérance favorise." } 
            },
            "111101": { 
                pinyin: "Dà Yǒu", 
                en: { name: "Great Possession", keywords: ["Abundance", "Power", "Clarity"], desc: "Supreme success." }, 
                fr: { name: "La Grande Possession", keywords: ["Abondance", "Puissance", "Clarté"], desc: "Succès suprême." } 
            },
            "001000": { 
                pinyin: "Qiān", 
                en: { name: "Modesty", keywords: ["Humility", "Respect", "Acceptance"], desc: "Success. The superior man carries things through." }, 
                fr: { name: "La Modestie", keywords: ["Humilité", "Respect", "Acceptation"], desc: "Succès. L'homme supérieur mène les choses à bien." } 
            },
            "000100": { 
                pinyin: "Yù", 
                en: { name: "Enthusiasm", keywords: ["Inspiration", "Movement", "Awakening"], desc: "Success. It furthers one to install helpers and to set armies marching." }, 
                fr: { name: "L'Enthousiasme", keywords: ["Inspiration", "Mouvement", "Éveil"], desc: "Succès. Il est utile d'installer des aides et de mettre les armées en marche." } 
            },
            "100110": { 
                pinyin: "Suí", 
                en: { name: "Following", keywords: ["Adaptability", "Flow", "Leadership"], desc: "Supreme success. Perseverance furthers. No blame." }, 
                fr: { name: "Suivre", keywords: ["Adaptabilité", "Flux", "Leadership"], desc: "Succès suprême. La persévérance favorise. Aucune faute." } 
            },
            "011001": { 
                pinyin: "Gǔ", 
                en: { name: "Work on the Decayed", keywords: ["Renewal", "Restoration", "Duty"], desc: "Supreme success. Before the starting point, three days. After the starting point, three days." }, 
                fr: { name: "Travailler sur le Décrépit", keywords: ["Renouveau", "Restauration", "Devoir"], desc: "Succès suprême. Trois jours avant le début. Trois jours après le début." } 
            },
            "110001": { 
                pinyin: "Lín", 
                en: { name: "Approach", keywords: ["Progress", "Expansion", "Care"], desc: "Supreme success. Perseverance furthers." }, 
                fr: { name: "L'Approche", keywords: ["Progrès", "Expansion", "Soin"], desc: "Succès suprême. La persévérance favorise." } 
            },
            "100011": { 
                pinyin: "Guān", 
                en: { name: "Contemplation", keywords: ["Perspective", "View", "Stillness"], desc: "Contemplation. The ablution has been made, but not yet the offering. Full sincerity." }, 
                fr: { name: "La Contemplation", keywords: ["Perspective", "Vue", "Calm"], desc: "Contemplation. L'ablution a été faite, mais pas encore l'offrande. Sincérité totale." } 
            },
            "100101": { 
                pinyin: "Shì Kè", 
                en: { name: "Biting Through", keywords: ["Decision", "Obstacles", "Justice"], desc: "Biting through has success. It is favorable to let justice be administered." }, 
                fr: { name: "Mordre à Travers", keywords: ["Décision", "Obstacles", "Justice"], desc: "Mordre a du succès. Il est favorable de laisser la justice être administrée." } 
            },
            "101001": { 
                pinyin: "Bì", 
                en: { name: "Grace", keywords: ["Beauty", "Adornment", "Form"], desc: "Grace has success. In small matters. It is favorable to undertake something." }, 
                fr: { name: "La Grâce", keywords: ["Beauté", "Ornement", "Forme"], desc: "La grâce a du succès. Dans les petites choses. Il est favorable d'entreprendre." } 
            },
            "000001": { 
                pinyin: "Bō", 
                en: { name: "Splitting Apart", keywords: ["Decay", "Disintegration", "Collapse"], desc: "Splitting apart. It does not further one to go anywhere." }, 
                fr: { name: "La Dislocation", keywords: ["Pourriture", "Désintégration", "Effondrement"], desc: "Dislocation. Il n'avance à rien d'aller quelque part." } 
            },
            "100000": { 
                pinyin: "Fù", 
                en: { name: "Return", keywords: ["Rebirth", "Cycle", "Turning Point"], desc: "Return. Success. Going out and coming in without error. Friends come without blame." }, 
                fr: { name: "Le Retour", keywords: ["Renaissance", "Cycle", "Point Tournant"], desc: "Retour. Succès. Sortir et entrer sans erreur. Les amis viennent sans faute." } 
            },
            "100111": { 
                pinyin: "Wú Wàng", 
                en: { name: "Innocence", keywords: ["Purity", "Spontaneity", "Naturalness"], desc: "Innocent. Supreme success. Perseverance furthers. If someone is not as he should be, he has misfortune." }, 
                fr: { name: "L'Innocence", keywords: ["Pureté", "Spontanéité", "Naturalité"], desc: "Innocent. Succès suprême. La persévérance favorise. Si quelqu'un n'est pas comme il devrait, il a le malheur." } 
            },
            "111001": { 
                pinyin: "Dà Chù", 
                en: { name: "Great Taming", keywords: ["Great Power", "Self-Control", "Stopping"], desc: "Great Taming. Perseverance furthers. Not eating at home brings good fortune." }, 
                fr: { name: "La Grande Entrave", keywords: ["Grand Puissance", "Maîtise de Soi", "Arrêt"], desc: "Grande Entrave. La persévérance favorise. Ne pas manger chez soi apporte le bonheur." } 
            },
            "100001": { 
                pinyin: "Yí", 
                en: { name: "Mouth Corners", keywords: ["Nourishment", "Speech", "Health"], desc: "The corners of the mouth. Perseverance brings good fortune. Pay heed to the providing of nourishment." }, 
                fr: { name: "Les Coins de la Bouche", keywords: ["Nourriture", "Parole", "Santé"], desc: "Les coins de la bouche. La persévérance apporte le bonheur. Prêtez attention à l'apport de nourriture." } 
            },
            "011110": { 
                pinyin: "Dà Guò", 
                en: { name: "Great Preponderance", keywords: ["Excess", "Crisis", "Load"], desc: "Great Preponderance. The ridgepole sags to the breaking point. It furthers one to have somewhere to go." }, 
                fr: { name: "La Prépondérance du Grand", keywords: ["Excès", "Crise", "Charge"], desc: "Prépondérance du Grand. Le faîte pèse jusqu'au point de rupture. Il est utile d'avoir où aller." } 
            },
            "010010": { 
                pinyin: "Kǎn", 
                en: { name: "The Abysmal", keywords: ["Danger", "Depth", "Wisdom"], desc: "The Abysmal repeated. If you are sincere, you have success in your heart." }, 
                fr: { name: "L'Abysse", keywords: ["Danger", "Profondeur", "Sagesse"], desc: "L'abysme répété. Si vous êtes sincère, vous avez du succès dans votre cœur." } 
            },
            "101101": { 
                pinyin: "Lí", 
                en: { name: "The Clinging", keywords: ["Dependence", "Clarity", "Radiance"], desc: "The Clinging. Perseverance furthers. It brings success. Care of the cow brings good fortune." }, 
                fr: { name: "L'Adhérence", keywords: ["Dépendance", "Clarté", "Rayonnement"], desc: "L'Adhérence. La persévérance favorise. Cela apporte le succès. S'occuper de la vache apporte le bonheur." } 
            },
            "001110": { 
                pinyin: "Xián", 
                en: { name: "Influence", keywords: ["Attraction", "Courtship", "Response"], desc: "Influence. Success. Perseverance furthers. Take a maiden for your wife." }, 
                fr: { name: "L'Influence", keywords: ["Attraction", "Séduction", "Réponse"], desc: "Influence. Succès. La persévérance favorise. Prendre une jeune fille pour épouse." } 
            },
            "011100": { 
                pinyin: "Héng", 
                en: { name: "Duration", keywords: ["Constancy", "Steadfastness", "Time"], desc: "Duration. Success. No blame. Perseverance furthers. To have somewhere to go brings good fortune." }, 
                fr: { name: "La Durée", keywords: ["Constance", "Fermeté", "Temps"], desc: "La Durée. Succès. Pas de faute. La persévérance favorise. Avoir où aller apporte le bonheur." } 
            },
            "001111": { 
                pinyin: "Dùn", 
                en: { name: "Retreat", keywords: ["Withdrawal", "Solitude", "Retreat"], desc: "Retreat. Success. In small matters, good fortune." }, 
                fr: { name: "La Retraite", keywords: ["Retrait", "Solitude", "Repli"], desc: "Retraite. Succès. Dans les petites choses, bonheur." } 
            },
            "111100": { 
                pinyin: "Dà Zhuàng", 
                en: { name: "Great Power", keywords: ["Great Strength", "Vigor", "Potential"], desc: "Great Power. Perseverance furthers." }, 
                fr: { name: "La Grandeur", keywords: ["Grande Force", "Vigueur", "Potentiel"], desc: "La Grandeur. La persévérance favorise." } 
            },
            "000101": { 
                pinyin: "Jìn", 
                en: { name: "Progress", keywords: ["Advancement", "Success", "Shine"], desc: "Progress. The powerful prince is honored with horses in large numbers." }, 
                fr: { name: "Le Progrès", keywords: ["Avancement", "Succès", "Lumière"], desc: "Le Progrès. Le prince puissant est honoré d'un grand nombre de chevaux." } 
            },
            "101000": { 
                pinyin: "Míng Yí", 
                en: { name: "Darkened", keywords: ["Adversity", "Patience", "Light"], desc: "Darkening of the Light. In adversity, it furthers one to be persevering." }, 
                fr: { name: "L'Obscurcissement", keywords: ["Adversité", "Patience", "Lumière"], desc: "Obscurcissement de la Lumière. Dans l'adversité, il est utile d'être persévérant." } 
            },
            "101011": { 
                pinyin: "Jiā Rén", 
                en: { name: "The Family", keywords: ["Home", "Relationships", "Duty"], desc: "The Family. The perseverance of the woman furthers." }, 
                fr: { name: "La Famille", keywords: ["Foyer", "Relations", "Devoir"], desc: "La Famille. La persévérance de la femme favorise." } 
            },
            "110101": { 
                pinyin: "Kuí", 
                en: { name: "Opposition", keywords: ["Conflict", "Alienation", "Understanding"], desc: "Opposition. In small matters, good fortune." }, 
                fr: { name: "L'Opposition", keywords: ["Conflit", "Aliénation", "Compréhension"], desc: "Opposition. Dans les petites choses, bonheur." } 
            },
            "001010": { 
                pinyin: "Jiǎn", 
                en: { name: "Obstruction", keywords: ["Difficulty", "Halt", "Reflection"], desc: "Obstruction. The southwest furthers. The northeast does not further." }, 
                fr: { name: "L'Entrave", keywords: ["Difficulté", "Arrêt", "Réflexion"], desc: "L'Entrave. Le sud-ouest favorise. Le nord-est ne favorise pas." } 
            },
            "010100": { 
                pinyin: "Xiè", 
                en: { name: "Deliverance", keywords: ["Release", "Solution", "Freedom"], desc: "Deliverance. The southwest furthers. If there is no longer anything where one has to go, return brings good fortune." }, 
                fr: { name: "La Délivrance", keywords: ["Libération", "Solution", "Liberté"], desc: "La Délivrance. Le sud-ouest favorise. S'il n'y a plus rien où aller, le retour apporte le bonheur." } 
            },
            "110001": { 
                pinyin: "Sǔn", 
                en: { name: "Decrease", keywords: ["Loss", "Sacrifice", "Humility"], desc: "Decrease combined with sincerity brings about supreme success without misfortune." }, 
                fr: { name: "La Diminution", keywords: ["Perte", "Sacrifice", "Humilité"], desc: "La diminution combinée avec la sincérité apporte un succès suprême sans malheur." } 
            },
            "100011": { 
                pinyin: "Yì", 
                en: { name: "Increase", keywords: ["Gain", "Growth", "Blessing"], desc: "Increase. Supreme success. Perseverance furthers." }, 
                fr: { name: "L'Accroissement", keywords: ["Gain", "Croissance", "Bénédiction"], desc: "L'Accroissement. Succès suprême. La persévérance favorise." } 
            },
            "111110": { 
                pinyin: "Guài", 
                en: { name: "Breakthrough", keywords: ["Resoluteness", "Action", "Clarity"], desc: "Breakthrough. One must resolutely make the matter known at the court of the king." }, 
                fr: { name: "L'Élancement", keywords: ["Résolution", "Action", "Clarté"], desc: "L'Élancement. On doit résolument faire connaître l'affaire à la cour du roi." } 
            },
            "011111": { 
                pinyin: "Gòu", 
                en: { name: "Coming to Meet", keywords: ["Encounter", "Warning", "Feminine Power"], desc: "Coming to Meet. The maiden is powerful. One should not marry such a maiden." }, 
                fr: { name: "La Rencontre", keywords: ["Rencontre", "Avertissement", "Pouvoir Féminin"], desc: "La Rencontre. La jeune fille est puissante. On ne doit pas épouser une telle jeune fille." } 
            },
            "000110": { 
                pinyin: "Cuì", 
                en: { name: "Gathering", keywords: ["Union", "Masses", "Support"], desc: "Gathering together. Success. The king approaches his temple. It furthers one to see the great man." }, 
                fr: { name: "Le Rassemblement", keywords: ["Union", "Masse", "Soutien"], desc: "Rassemblement. Succès. Le roi s'approche de son temple. Il est utile de voir le grand homme." } 
            },
            "011000": { 
                pinyin: "Shēng", 
                en: { name: "Pushing Upward", keywords: ["Ascension", "Growth", "Effort"], desc: "Pushing upward has supreme success. One must see the great man. Fear not." }, 
                fr: { name: "L'Ascension", keywords: ["Ascension", "Croissance", "Effort"], desc: "L'Ascension a un succès suprême. On doit voir le grand homme. Ne craignez pas." } 
            },
            "010110": { 
                pinyin: "Kùn", 
                en: { name: "Oppression", keywords: ["Hardship", "Exhaustion", "Endurance"], desc: "Oppression. Success. Perseverance. The great man brings about good fortune. No blame." }, 
                fr: { name: "L'Oppression", keywords: ["Détresse", "Épuisement", "Endurance"], desc: "L'Oppression. Succès. Persévérance. Le grand homme apporte le bonheur. Pas de faute." } 
            },
            "011010": { 
                pinyin: "Jǐng", 
                en: { name: "The Well", keywords: ["Resource", "Depth", "Nourishment"], desc: "The Well. The town may be changed, but the well cannot be changed." }, 
                fr: { name: "Le Puits", keywords: ["Ressource", "Profondeur", "Nourriture"], desc: "Le Puits. La ville peut changer, mais le puits ne peut changer." } 
            },
            "011011": { 
                pinyin: "Gé", 
                en: { name: "Revolution", keywords: ["Change", "Molting", "Transition"], desc: "Revolution. On your own day you are believed. Supreme success. Furthering through perseverance brings remorse." }, 
                fr: { name: "La Révolution", keywords: ["Changement", "Mue", "Transition"], desc: "La Révolution. En votre propre jour, vous êtes cru. Succès suprême. Avancer par persévérance apporte des remords." } 
            },
            "001101": { 
                pinyin: "Dǐng", 
                en: { name: "The Cauldron", keywords: ["Establishment", "Nourishment", "Civilization"], desc: "The Cauldron. Supreme good fortune. Success." }, 
                fr: { name: "Le Chaudron", keywords: ["Établissement", "Nourriture", "Civilisation"], desc: "Le Chaudron. Grand bonheur. Succès." } 
            },
            "100100": { 
                pinyin: "Zhèn", 
                en: { name: "The Arousing", keywords: ["Shock", "Movement", "Awakening"], desc: "The Arousing brings success. The Arousing comes." }, 
                fr: { name: "L'Éveilleur", keywords: ["Choc", "Mouvement", "Réveil"], desc: "L'Éveilleur apporte le succès. L'Éveilleur arrive." } 
            },
            "001001": { 
                pinyin: "Gèn", 
                en: { name: "Keeping Still", keywords: ["Stagnation", "Rest", "Stillness"], desc: "Keeping Still. Keeping his back still so that he no longer feels his body." }, 
                fr: { name: "Le Repos", keywords: ["Stagnation", "Repos", "Calme"], desc: "Le Repos. Garder son dos immobile pour qu'il ne ressente plus son corps." } 
            },
            "001011": { 
                pinyin: "Jiàn", 
                en: { name: "Development", keywords: ["Gradual Progress", "Steady", "Courtship"], desc: "Development. The maiden is given in marriage. Good fortune. Perseverance furthers." }, 
                fr: { name: "Le Développement", keywords: ["Progrès Graduel", "Stable", "Cour"], desc: "Le Développement. La jeune fille est donnée en mariage. Bonheur. La persévérance favorise." } 
            },
            "110100": { 
                pinyin: "Guī Mèi", 
                en: { name: "The Marrying Maiden", keywords: ["Subordination", "Marginality"], desc: "The Marrying Maiden. Undertakings bring misfortune. Nothing that would further." }, 
                fr: { name: "La Mariée", keywords: ["Subordination", "Marginalité"], desc: "La Mariée. Les entreprises amènent le malheur. Rien qui favorise." } 
            },
            "101100": { 
                pinyin: "Fēng", 
                en: { name: "Abundance", keywords: ["Fullness", "Peak", "Clarity"], desc: "Abundance has success. The king attains abundance. Be not sad." }, 
                fr: { name: "L'Abondance", keywords: ["Plénitude", "Sommet", "Clarté"], desc: "L'Abondance a du succès. Le roi atteint l'abondance. Ne soyez pas triste." } 
            },
            "001110": { 
                pinyin: "Lǚ", 
                en: { name: "The Wanderer", keywords: ["Travel", "Frugality", "Caution"], desc: "The Wanderer. Success through smallness. Perseverance brings good fortune to the wanderer." }, 
                fr: { name: "Le Voyageur", keywords: ["Voyage", "Frugalité", "Prudence"], desc: "Le Voyageur. Succès par la petitesse. La persévérance apporte le bonheur au voyageur." } 
            },
            "101010": { 
                pinyin: "Xùn", 
                en: { name: "The Gentle", keywords: ["Penetrating", "Wind", "Flexibility"], desc: "The Gentle. Success through what is small. It furthers one to have somewhere to go." }, 
                fr: { name: "Le Doux", keywords: ["Pénétration", "Vent", "Flexibilité"], desc: "Le Doux. Succès par la petitesse. Il est utile d'avoir où aller." } 
            },
            "011101": { 
                pinyin: "Duì", 
                en: { name: "The Joyous", keywords: ["Pleasure", "Friendliness", "Openness"], desc: "The Joyous. Success. Perseverance is favorable." }, 
                fr: { name: "Le Joyeux", keywords: ["Plaisir", "Amitié", "Ouverture"], desc: "Le Joyeux. Succès. La persévérance est favorable." } 
            },
            "010011": { 
                pinyin: "Huàn", 
                en: { name: "Dispersion", keywords: ["Disintegration", "Release", "Spiritual"], desc: "Dispersion. Success. The king approaches his temple. It furthers one to cross the great water." }, 
                fr: { name: "La Dispersion", keywords: ["Désintégration", "Libération", "Spirituel"], desc: "La Dispersion. Succès. Le roi s'approche de son temple. Il est utile de traverser la grande eau." } 
            },
            "110010": { 
                pinyin: "Jié", 
                en: { name: "Limitation", keywords: ["Discipline", "Moderation", "Boundaries"], desc: "Limitation. Success. Galling limitation must not be persevered in." }, 
                fr: { name: "La Limitation", keywords: ["Discipline", "Modération", "Limites"], desc: "La Limitation. Succès. Une limitation irritante ne doit pas être persévérée." } 
            },
            "110011": { 
                pinyin: "Zhōng Fú", 
                en: { name: "Inner Truth", keywords: ["Sincerity", "Trust", "Heart"], desc: "Inner Truth. Pigs and fishes. Good fortune. It furthers one to cross the great water." }, 
                fr: { name: "La Vérité Intérieure", keywords: ["Sincérité", "Confiance", "Cœur"], desc: "La Vérité Intérieure. Cochons et poissons. Bonheur. Il est utile de traverser la grande eau." } 
            },
            "001100": { 
                pinyin: "Xiǎo Guò", 
                en: { name: "Small Preponderance", keywords: ["Excess Minor", "Detail", "Caution"], desc: "Small Preponderance. Success. Perseverance furthers. Small things may be done; great things should not be done." }, 
                fr: { name: "La Prépondérance du Petit", keywords: ["Excès Mineur", "Détail", "Prudence"], desc: "La Prépondérance du Petit. Succès. La persévérance favorise. Les petites choses peuvent être faites ; les grandes choses ne doivent pas l'être." } 
            },
            "101010": { 
                pinyin: "Jì Jì", 
                en: { name: "After Completion", keywords: ["Ending", "Transition", "Care"], desc: "After Completion. Success in small matters. Perseverance furthers." }, 
                fr: { name: "Après l'Accomplissement", keywords: ["Fin", "Transition", "Soin"], desc: "Après l'Accomplissement. Succès dans les petites choses. La persévérance favorise." } 
            },
            "010101": { 
                pinyin: "Wèi Jì", 
                en: { name: "Before Completion", keywords: ["Beginning", "Chaos", "Potential"], desc: "Before Completion. Success. But the small fox crosses the ice. Get his tail wet." }, 
                fr: { name: "Avant l'Accomplissement", keywords: ["Début", "Chaos", "Potentiel"], desc: "Avant l'Accomplissement. Succès. Mais le petit renard traverse la glace. Il mouille sa queue." } 
            }
        };

        // DOM Elements
        const stage = document.getElementById('stage');
        const hexContainer = document.getElementById('hexagram-container');
        const castBtn = document.getElementById('cast-btn');
        const resultCard = document.getElementById('result-card');
        const resName = document.getElementById('res-name');
        const resPinyin = document.getElementById('res-pinyin');
        const resDesc = document.getElementById('res-desc');
        const resKeywords = document.getElementById('res-keywords');
        const movingMsg = document.getElementById('moving-msg');
        const toast = document.getElementById('toast');
        const langToggle = document.getElementById('lang-toggle');
        const appTitle = document.getElementById('app-title');
        const appSubtitle = document.getElementById('app-subtitle');

        // State
        let isCasting = false;
        const lines = []; 
        let currentHexKey = null; // Store current hexagram to re-translate

        // Helper: Show Toast
        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Function: Toggle Language
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'fr' : 'en';
            langToggle.textContent = currentLang === 'en' ? 'FR' : 'ENG';
            
            // Update UI Text
            const txt = uiText[currentLang];
            appTitle.textContent = txt.title;
            appSubtitle.textContent = txt.subtitle;
            if (isCasting) {
                castBtn.textContent = txt.consulting;
            } else {
                castBtn.textContent = lines.length > 0 ? txt.castAgain : txt.cast;
            }
            movingMsg.textContent = txt.movingMsg;

            // Re-display result if exists
            if (currentHexKey) {
                displayResult(currentHexKey);
            }
        }

        langToggle.addEventListener('click', toggleLanguage);

        // Function: Toss 3 Coins
        function tossCoins() {
            return new Promise((resolve) => {
                const coins = document.querySelectorAll('.coin');
                let sum = 0;

                coins.forEach((coin) => {
                    // Logic: Heads = 3, Tails = 2
                    const isHead = Math.random() > 0.5;
                    const val = isHead ? 3 : 2;
                    sum += val;

                    const baseSpins = 5 * 360; 
                    const outcomeRot = isHead ? 0 : 180;
                    const totalRot = baseSpins + outcomeRot;
                    const randomStart = Math.floor(Math.random() * 360);
                    
                    coin.style.transition = 'none';
                    coin.style.transform = `rotateY(${randomStart}deg)`;
                    coin.offsetHeight; // Reflow
                    coin.style.transition = 'transform 1s ease-out';
                    coin.style.transform = `rotateY(${totalRot}deg)`;
                    coin.dataset.currentRot = totalRot + randomStart;
                });

                setTimeout(() => {
                    resolve(sum);
                }, 1100);
            });
        }

        // Function: Interpret Coin Sum
        function interpretLine(sum) {
            if (sum === 6) return { val: 0, type: 'yin', moving: true };
            if (sum === 7) return { val: 1, type: 'yang', moving: false };
            if (sum === 8) return { val: 0, type: 'yin', moving: false };
            if (sum === 9) return { val: 1, type: 'yang', moving: true };
            return { val: 1, type: 'yang', moving: false };
        }

        // Function: Render Line visually
        function renderLine(lineObj, index) {
            const lineEl = document.createElement('div');
            lineEl.className = `line ${lineObj.type}`;
            if (lineObj.moving) lineEl.classList.add('moving');
            lineEl.style.animationDelay = `${index * 0.2}s`;
            hexContainer.appendChild(lineEl);
        }

        // Main Casting Logic
        async function castHexagram() {
            if (isCasting) return;
            isCasting = true;
            
            // Update Button State
            castBtn.disabled = true;
            castBtn.textContent = uiText[currentLang].consulting;
            
            // Reset Visuals
            lines.length = 0;
            hexContainer.innerHTML = '';
            hexContainer.classList.remove('visible');
            resultCard.style.display = 'none';
            currentHexKey = null;
            
            await new Promise(r => setTimeout(r, 200));
            hexContainer.classList.add('visible');

            // Toss 6 times
            for (let i = 0; i < 6; i++) {
                const sum = await tossCoins();
                const lineData = interpretLine(sum);
                lines.push(lineData);
                renderLine(lineData, i);
                await new Promise(r => setTimeout(r, 300));
            }

            // Compile Result
            const topToBottom = [...lines].reverse();
            const binaryKey = topToBottom.map(l => l.val).join('');
            currentHexKey = binaryKey;
            
            displayResult(binaryKey);

            isCasting = false;
            castBtn.disabled = false;
            castBtn.textContent = uiText[currentLang].castAgain;
        }

        // Display Result
        function displayResult(key) {
            const data = hexagramData[key];
            const txt = data[currentLang]; // Get lang specific data
            
            resName.textContent = txt.name;
            resPinyin.textContent = data.pinyin;
            resDesc.textContent = txt.desc;
            
            resKeywords.innerHTML = txt.keywords.map(k => `<span class="tag">${k}</span>`).join('');

            const hasMoving = lines.some(l => l.moving);
            movingMsg.style.display = hasMoving ? 'block' : 'none';

            resultCard.style.display = 'block';
            
            if (window.innerWidth < 600) {
                resultCard.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Event Listener
        castBtn.addEventListener('click', castHexagram);

    </script>
</body>
</html>
